{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nimport * as d3 from 'd3';\nimport { MapperService } from 'src/app/services/mapper/mapper.service';\nimport { NGXLogger } from 'ngx-logger';\nimport { DrugService } from 'src/app/services/drug/drug.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/mapper/mapper.service\";\nimport * as i2 from \"src/app/services/drug/drug.service\";\nimport * as i3 from \"ngx-logger\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/grid-list\";\nimport * as i6 from \"@angular/material/card\";\nfunction DisplayComponent_mat_card_15_h4_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h4\");\n    i0.ɵɵtext(1, \"Purpose\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DisplayComponent_mat_card_15_p_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    var ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r2._current.purpose);\n  }\n}\nfunction DisplayComponent_mat_card_15_h4_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h4\");\n    i0.ɵɵtext(1, \"Warnings\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DisplayComponent_mat_card_15_p_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    var ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r4._current.warnings);\n  }\n}\nfunction DisplayComponent_mat_card_15_h4_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h4\");\n    i0.ɵɵtext(1, \"Similar Drugs\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DisplayComponent_mat_card_15_p_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    var ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r6._currentSimilar.join(\"\\n\\n\"), \" \");\n  }\n}\nfunction DisplayComponent_mat_card_15_h4_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h4\");\n    i0.ɵɵtext(1, \" Negative Drug Interactions \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DisplayComponent_mat_card_15_p_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    var ctx_r8 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r8._currentInteractions.join(\"\\n\"), \" \");\n  }\n}\nfunction DisplayComponent_mat_card_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\", 9)(1, \"mat-card-header\")(2, \"mat-card-title\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"mat-card-subtitle\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"mat-card-content\");\n    i0.ɵɵtemplate(7, DisplayComponent_mat_card_15_h4_7_Template, 2, 0, \"h4\", 10);\n    i0.ɵɵtemplate(8, DisplayComponent_mat_card_15_p_8_Template, 2, 1, \"p\", 10);\n    i0.ɵɵtemplate(9, DisplayComponent_mat_card_15_h4_9_Template, 2, 0, \"h4\", 10);\n    i0.ɵɵtemplate(10, DisplayComponent_mat_card_15_p_10_Template, 2, 1, \"p\", 10);\n    i0.ɵɵtemplate(11, DisplayComponent_mat_card_15_h4_11_Template, 2, 0, \"h4\", 10);\n    i0.ɵɵtemplate(12, DisplayComponent_mat_card_15_p_12_Template, 2, 1, \"p\", 10);\n    i0.ɵɵtemplate(13, DisplayComponent_mat_card_15_h4_13_Template, 2, 0, \"h4\", 10);\n    i0.ɵɵtemplate(14, DisplayComponent_mat_card_15_p_14_Template, 2, 1, \"p\", 10);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    var ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0._currentName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0._current.brandName);\n    i0.ɵɵadvance(1);\n    i0.ɵɵstyleProp(\"overflow\", \"auto\")(\"height\", \"600\", \"px\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0._current.purpose);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0._current.purpose);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0._current.warnings);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0._current.warnings);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0._currentSimilar.length > 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0._currentSimilar.length > 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0._currentInteractions.length > 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0._currentInteractions.length > 0);\n  }\n}\nvar DisplayComponent = /** @class */function () {\n  function DisplayComponent(mapperService, drugService, logger) {\n    this.mapperService = mapperService;\n    this.drugService = drugService;\n    this.logger = logger;\n  }\n  DisplayComponent.prototype.ngOnInit = function () {};\n  DisplayComponent.prototype.ngAfterViewInit = function () {\n    var size = document.getElementsByClassName('graph').item(0).getBoundingClientRect();\n    this._width = size.width;\n    this._height = size.height;\n    if (this._current) {\n      this.draw();\n    }\n  };\n  Object.defineProperty(DisplayComponent.prototype, \"currentDrug\", {\n    /**\r\n     * Object representation of recommended drug\r\n     */\n    set: function (input) {\n      this._current = input;\n      this._currentName = this._current.genericName.split(/(\\s-\\s)|,/)[0];\n      this._currentSimilar = this._current.similar ? this._current.similar.map(function (_a) {\n        var genericName = _a.genericName;\n        return genericName;\n      }) : new Array();\n      this._currentInteractions = this._current.interactions ? this._current.interactions.map(function (_a) {\n        var genericName = _a.genericName;\n        return genericName;\n      }) : new Array();\n      if (this._width > 0 && this._height > 0) {\n        this.draw();\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  // Draw the d3 graph\n  DisplayComponent.prototype.draw = function () {\n    var _this = this;\n    d3.selectAll('svg > *').remove();\n    this.logger.debug(\"DisplayComponent.draw: Drawing the D3 graph for \".concat(this._current.genericName));\n    this.CreateMapping().then(function (m) {\n      var nodes = m.nodes.map(function (d) {\n        return Object.create(d);\n      });\n      var links = m.links.map(function (d) {\n        return Object.create(d);\n      });\n      var graph = d3.select('svg');\n      var simulation = d3.forceSimulation(nodes).force('link', d3.forceLink(links).id(_this.getId)).force('charge', d3.forceManyBody().strength(-20)).force('center', d3.forceCenter(_this._width / 2, _this._height / 2)).force('collide', d3.forceCollide().radius(51));\n      var link = _this.createLinks(graph, links);\n      var node = _this.createNodes(graph, nodes, simulation);\n      simulation.on('tick', function () {\n        return _this.ticked(link, node);\n      });\n    });\n  };\n  // Create mapping for currently recommended drug\n  DisplayComponent.prototype.CreateMapping = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.mapperService.get(this._current)];\n          case 1:\n            return [2 /*return*/, _a.sent()];\n        }\n      });\n    });\n  };\n  // Create links\n  DisplayComponent.prototype.createLinks = function (graph, links) {\n    return graph.append('g').attr('stroke', '#bdbdbd').attr('stroke-opacity', 0.6).selectAll('line').data(links).enter().append('line').attr('stroke-width', 2);\n  };\n  // Create nodes and labels\n  DisplayComponent.prototype.createNodes = function (graph, nodes, simulation) {\n    var _this = this;\n    var node = graph.append('g').selectAll('.node').attr('stroke', 'transparent').attr('stroke-width', 0.5).data(nodes).enter().append('g').attr('class', 'node').call(d3.drag().on('start', function (d) {\n      return _this.onDragStart(d, simulation);\n    }).on('drag', this.onDragged).on('end', function (d) {\n      return _this.onDragEnded(d, simulation);\n    })).on('click', function (d) {\n      _this.changeCurrent(d.name);\n    });\n    // Add nodes\n    node.append('circle').attr('r', this.getSize).attr('fill', this.getColor);\n    // Add labels\n    node.append('text').attr('class', 'label').style('cursor', 'default').style('text-anchor', 'middle').style('font-size', function (d) {\n      return d.degree < 1 ? '12pt' : '8pt';\n    }).text(function (d) {\n      return d.degree < 2 ? d.name.genericName.split(/(\\s-\\s)|,/)[0] : '';\n    });\n    return node;\n  };\n  // Update nodes and links to the correct location\n  DisplayComponent.prototype.ticked = function (link, node) {\n    link.attr('x1', function (d) {\n      return d.source.x;\n    }).attr('y1', function (d) {\n      return d.source.y;\n    }).attr('x2', function (d) {\n      return d.target.x;\n    }).attr('y2', function (d) {\n      return d.target.y;\n    });\n    node.attr('transform', function (d) {\n      return \"translate(\".concat(d.x, \",\").concat(d.y, \")\");\n    });\n  };\n  // Change currently recommended drug to the one selected by user\n  DisplayComponent.prototype.changeCurrent = function (name) {\n    var _this = this;\n    this.logger.debug(\"DisplayComponent.changeCurrent: Change current recommended drug to generic name(\".concat(name.genericName, \") and brand name (\").concat(name.brandName, \")\"));\n    this.drugService.get(name).subscribe(function (d) {\n      return _this.currentDrug = d;\n    });\n  };\n  // Get name as id for the current node\n  DisplayComponent.prototype.getId = function (data) {\n    return data.id;\n  };\n  // Get node radius for the provided node\n  DisplayComponent.prototype.getSize = function (data) {\n    switch (data.degree) {\n      case 0:\n        return 50;\n      case 1:\n        return 20;\n      case 2:\n        return 10;\n      default:\n        return 5;\n    }\n  };\n  // Get color for the provided node\n  DisplayComponent.prototype.getColor = function (data) {\n    switch (data.degree) {\n      case 0:\n        return '#8bc34a';\n      case 1:\n        if (data.isSimilar) {\n          return '#03a9f4';\n        }\n        return '#ef5350';\n      default:\n        if (data.isSimilar) {\n          return '#77a1b4';\n        }\n        return '#b68887';\n    }\n  };\n  // Update node location on drag start\n  DisplayComponent.prototype.onDragStart = function (d, simulation) {\n    if (!d3.event.active) {\n      simulation.alphaTarget(0.3).restart();\n    }\n    d.fx = d.x;\n    d.fy = d.y;\n  };\n  // Update node location on drag\n  DisplayComponent.prototype.onDragged = function (d) {\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  };\n  // Fix node location on drag ended\n  DisplayComponent.prototype.onDragEnded = function (d, simulation) {\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n    if (!d3.event.active) {\n      simulation.alphaTarget(0);\n    }\n  };\n  DisplayComponent.ɵfac = function DisplayComponent_Factory(t) {\n    return new (t || DisplayComponent)(i0.ɵɵdirectiveInject(i1.MapperService), i0.ɵɵdirectiveInject(i2.DrugService), i0.ɵɵdirectiveInject(i3.NGXLogger));\n  };\n  DisplayComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: DisplayComponent,\n    selectors: [[\"app-display\"]],\n    inputs: {\n      currentDrug: \"currentDrug\"\n    },\n    decls: 16,\n    vars: 1,\n    consts: [[1, \"recommendation-result\"], [\"cols\", \"4\", \"rowHeight\", \"700\"], [\"colspan\", \"3\"], [\"width\", \"100%\", \"height\", \"700\", 1, \"graph\"], [1, \"legend\"], [1, \"key-dot\", \"recommended\"], [1, \"key-dot\", \"similar\"], [1, \"key-dot\", \"negative\"], [\"tabindex\", \"-1\", 4, \"ngIf\"], [\"tabindex\", \"-1\"], [4, \"ngIf\"]],\n    template: function DisplayComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"mat-grid-list\", 1)(2, \"mat-grid-tile\", 2);\n        i0.ɵɵnamespaceSVG();\n        i0.ɵɵelement(3, \"svg\", 3);\n        i0.ɵɵnamespaceHTML();\n        i0.ɵɵelementStart(4, \"div\", 4)(5, \"p\");\n        i0.ɵɵelement(6, \"span\", 5);\n        i0.ɵɵtext(7, \"Recommended Drug\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"p\");\n        i0.ɵɵelement(9, \"span\", 6);\n        i0.ɵɵtext(10, \"Similar Drugs\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"p\");\n        i0.ɵɵelement(12, \"span\", 7);\n        i0.ɵɵtext(13, \"Negative Interactions\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(14, \"mat-grid-tile\");\n        i0.ɵɵtemplate(15, DisplayComponent_mat_card_15_Template, 15, 14, \"mat-card\", 8);\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(15);\n        i0.ɵɵproperty(\"ngIf\", ctx._current);\n      }\n    },\n    dependencies: [i4.NgIf, i5.MatGridList, i5.MatGridTile, i6.MatCard, i6.MatCardContent, i6.MatCardHeader, i6.MatCardSubtitle, i6.MatCardTitle],\n    styles: [\".recommendation-result[_ngcontent-%COMP%]   mat-grid-list[_ngcontent-%COMP%]{width:80%;margin-left:10%}.legend[_ngcontent-%COMP%]{position:absolute;margin-left:80%;margin-top:640px;font-size:9pt}.legend[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:1px}.legend[_ngcontent-%COMP%]   .key-dot[_ngcontent-%COMP%]{display:inline-block;height:10px;margin-right:.5em;width:10px}.legend[_ngcontent-%COMP%]   .recommended[_ngcontent-%COMP%]{background:#8bc34a}.legend[_ngcontent-%COMP%]   .similar[_ngcontent-%COMP%]{background:#03a9f4}.legend[_ngcontent-%COMP%]   .negative[_ngcontent-%COMP%]{background:#ef5350}mat-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{white-space:pre-line}\"]\n  });\n  return DisplayComponent;\n}();\nexport { DisplayComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}